/*
 * qure.js [v0.2.15]
 * https://github.com/hbi99/qure.js 
 * Copyright (c) 2013-2016, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the MIT License
 */
!function(window,module){"use strict";function Queue(e,t){this._methods=[],this._owner=e,this._that=t,this._paused=!1}function CORSreq(e,t,s,r){var n,u=new window.XMLHttpRequest,i=t.method||"GET",a=t.url;u.onreadystatechange=this.readystatechange,u.autoParse=this.autoParse,u.hash=s,u.key=r,u.url=a,u.owner=e,t.data&&(n=param.parse(t.data),"GET"===i&&t.data&&(a+=-1===a.indexOf("?")?"?":"&",a+=param.parse(t.data))),"withCredentials"in u&&u.open(i,a,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.send(n)}function Qure(){var e={};return this.queue=new Queue(this,e),this}var isNode=!!module.id,syncFunc={_globals:{require:isNode?require:!1,module:isNode?module:!1}},workFunc={};Queue.prototype={push:function(e){this._methods.push(e),this._paused||this.flush()},unshift:function(e){this._methods.unshift(e),this._paused||this.flush()},flush:function(){var e,t=arguments;if(!this._paused)for(;this._methods[0];)if(e=this._methods.shift(),e.apply(this._that,t),e._paused){this._paused=!0;break}}};var x10={setup:function(e){var t,s,r,n=window.URL||window.webkitURL,u="var tree = {"+this.parse(e).join(",")+"};";return isNode?(r=function(t){var s=JSON.parse(t).data,r=s.shift(),n=e[r].apply(e,s);process.send(JSON.stringify([r,n]))},s=s=new window.Worker,u=u+'process.on("message", '+r.toString()+");",s.postMessage(u)):(r=function(t){var s=Array.prototype.slice.call(t.data,1),r=t.data[0],n=e[r].apply(e,s);postMessage([r,n])},t=new Blob([u+'self.addEventListener("message", '+r.toString()+", false);"],{type:"text/javascript"}),s=new window.Worker(n.createObjectURL(t))),s.onmessage=function(e){var t=Array.prototype.slice.call(e.data,1),s=e.data[0];-1===["pause","resume","precede"].indexOf(s)&&(s="resume"),this.qure[s].apply(this.qure,t)},s},call_handler:function(e,t,s){return function(){var r=Array.prototype.slice.call(arguments);r.unshift(e),s.pause(!0),t.qure=s,t.postMessage(r)}},compile:function(e,t){var s,r=this.setup(e);for(s in e)workFunc[s]=this.call_handler(s,r,t);workFunc._worker=r},parse:function(e,t){var s,r,n,u=[];for(s in e)if(n=e[s],null!==n)if(void 0!==n){switch(n.constructor){case Date:r="new Date("+n.valueOf()+")";break;case Object:r="{"+this.parse(n).join(",")+"}";break;case Array:r="["+this.parse(n,!0).join(",")+"]";break;case String:r='"'+n.replace(/"/g,'\\"')+'"';break;case RegExp:r=n.toString(),r='new RegExp("'+r.slice(1,r.lastIndexOf("/"))+'", "'+r.slice(r.lastIndexOf("/")+1)+'")';break;case Function:r=n.toString().replace(/\bself\b/g,"this."+s);break;default:r=n}t?u.push(r):u.push(s+":"+r)}else u.push(s+":undefined");else u.push(s+":null");return isNode&&(u.push("pause   : function() { process.send(JSON.stringify(['pause'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("resume  : function() { process.send(JSON.stringify(['resume'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("precede : function() { process.send(JSON.stringify(['precede'].concat(Array.prototype.slice.call(arguments)))); }")),u},parseFunc:function(e,t){var s,r,n=t.toString();return s=n.match(/functio.+?\((.*?)\)/)[1].split(","),r=n.match(/functio.+?\{([\s\S]*)\}/i)[1].trim(),r=r.replace(/\bself\b/g,"this."+e),r=r.replace(/\brequire\b/g,"this._globals.require"),r=r.replace(/\bmodule\b/g,"this._globals.module"),r=r.replace(/\.pause\(/g,"._globals.qure.pause("),r=r.replace(/\.resume\(/g,"._globals.qure.resume("),r=r.replace(/\.precede\(/g,"._globals.qure.precede("),s.push(r),Function.apply({},s)}};CORSreq.prototype={readystatechange:function(e){var t,s,r=e.target,n={},u=[],i=!0;if(200===r.status&&4===r.readyState){if(s=this.autoParse(this.url,r.responseText),this.hash){this.hash[this.key]={responseText:s,status:r.status};for(t in this.hash)200!==this.hash[t].status&&(i=!1);if(i){for(t in this.hash)n[t]=this.hash[t].responseText;u.push(this.hash._single?this.hash._single.responseText:n)}}else u.push({responseText:s,status:r.status});this.owner.queue._paused=!1,this.owner.queue.flush.apply(this.owner.queue,u)}},autoParse:function(url,str){var isDeclare="?declare"===url.slice(-8),ext=url.split("."),ret,type,parser;switch(ext=ext[ext.length-1],isDeclare&&(ext=ext.slice(0,-8)),ext){case"css":isNode?ret=str:(ret=window.document.createElement("style"),ret.innerHTML=str);break;case"js":isNode||isDeclare?(eval("(function(window, module) {"+str+'}).bind({})(	typeof window !== "undefined" ? window : {},	typeof module !== "undefined" ? module : {});'),ret=module.exports,delete module.exports):(ret=document.createElement("script"),ret.type="text/javascript",ret.appendChild(document.createTextNode(str)));break;case"json":ret=JSON.parse(str);break;case"htm":case"html":type="text/html";case"xml":case"xsl":isNode?ret=str:(parser=new DOMParser,ret=parser.parseFromString(str,type||"text/xml"));break;default:ret=str}return ret}};var param={parse:function(e){var t,s=this;if(this.serialize=[],e.constructor===Array)e.forEach(function(e,t){s.add(t,e)});else for(t in e)this.build(t,e[t]);return this.serialize.join("&")},add:function(e,t){t=t.constructor===Function?t():null===t?"":t,this.serialize.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},build:function(e,t){var s,r=this;if(t.constructor===Array)t.forEach(function(t,s){r.build(e+"["+("object"==typeof t&&null!==t?s:"")+"]",t)});else if("object"==typeof t)for(s in t)this.build(e+"["+s+"]",t[s]);else this.add(e,t)}};Qure.prototype={fork:function(){return new Qure},wait:function(e){var t=this,s=function(){setTimeout(function(){t.queue._paused=!1,t.queue.flush()},e||0)};return s._paused=!0,this.queue.push(s),this},then:function(e){var t=this,s=function(){var s=[];syncFunc._globals.res?(s.push(syncFunc._globals.res),delete syncFunc._globals.res):s=arguments,e.apply(t.queue._that,s),!t.queue._methods.length&&workFunc._worker&&workFunc._worker.process&&workFunc._worker.process.kill()};return this.queue.push(s),this},xhr:function(e){var t=this,s=function(){new CORSreq(t,e)};return s._paused=!0,this.queue.push(s),this},load:function(e,t,s){var r,n=this,u=function(){new CORSreq(n,e,t,s)};if(!t&&"object"==typeof e){for(r in e)this.load({url:e[r]},e,r);return this}return t?(u._paused=!0,this.queue.push(u),this):this.load({_single:e})},declare:function(e){var t=this,s=function(){var s,r,n={},u=e.workers;for(s in e)r=e[s],r.constructor===Function?u?n[s]=e[s]:syncFunc[s]=x10.parseFunc(s,e[s]):syncFunc[s]=n[s]=e[s];x10.compile(n,t)};if("string"==typeof e){var r=function(r){t.precede(function(){e+="?declare",t.fork().load(e).then(function(r){e=r,s(r),t.resume()})})};r._paused=!0,this.precede(r)}else this.queue.push(s);return this},run:function(){var e=this,t=Array.prototype.slice.call(arguments),s=function(){var s=t.shift();syncFunc[s]?(syncFunc._globals.qure=e,syncFunc._globals.res=syncFunc[s].apply(syncFunc,t)):(e.pause(!0),workFunc[s].apply(workFunc,t))};return this.queue.push(s),this},precede:function(e){return this.queue.unshift(e),this},resume:function(){return this.queue._paused=!1,this.queue.flush.apply(this.queue,arguments),this},pause:function(e){var t=function(){};return t._paused=!0,e?this.queue.unshift(t):this.queue.push(t),this}},isNode&&(window.Worker=require("./worker"),window.XMLHttpRequest=require("./xhr")),window.Qure=module.exports=new Qure}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{});