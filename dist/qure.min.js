/* 
 * QureJS v0.2.3 
 * Tiny library introducing an easy design pattern. 
 * https://github.com/hbi99/QureJS.js 
 * 
 * Copyright (c) 2013-2015, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the  License 
 */ 
!function(a,b){"use strict";function c(a,b){this._methods=[],this._owner=a,this._that=b,this._paused=!1}function d(a,b,c,d){var e="GET",f=new XMLHttpRequest;if("withCredentials"in f)f.open(e,b,!0);else{if("undefined"==typeof XDomainRequest)throw"XHR not supported";f=new XDomainRequest,f.open(e,b)}return f.hash=c,f.key=d,f.owner=a,f.onload=this.doload,f}function e(){var a={};return this.queue=new c(this,a),this}var f=!!b.id,g={_globals:{require:f?require:!1,module:f?b:!1}},h={};c.prototype={push:function(a){this._methods.push(a),this._paused||this.flush()},unshift:function(a){this._methods.unshift(a),this._paused||this.flush()},flush:function(){var a,b=arguments;if(!this._paused)for(;this._methods[0];)if(a=this._methods.shift(),a.apply(this._that,b),a._paused){this._paused=!0;break}}};var i=function(){var a={};return{on:function(b,c){a[b]||(a[b]=[]),a[b].unshift(c)},off:function(b,c){if(a[b]){var d=a[b].indexOf(c);a[b].splice(d,1)}},emit:function(b,c){if(a[b])for(var d={type:b,detail:c,isCanceled:!1,cancelBubble:function(){this.isCanceled=!0}},e=a[b].length;e--;){if(d.isCanceled)return;a[b][e](d)}}}},j={init:function(){return this},work_handler:function(a){var b=Array.prototype.slice.call(a.data,1),c=a.data[0],d=tree[c].apply(tree,b);postMessage([c,d])},setup:function(b){var c=a.URL||a.webkitURL,d="var tree = {"+this.parse(b).join(",")+"};",e=new Blob([d+'self.addEventListener("message", '+this.work_handler.toString()+", false);"],{type:"text/javascript"}),f=new Worker(c.createObjectURL(e));return f.onmessage=function(a){var b=Array.prototype.slice.call(a.data,1),c=a.data[0];j.observer.emit("thread:"+c,b)},f},call_handler:function(a,b,c){return function(){var d=[].slice.call(arguments),e=function(b){j.observer.off("thread:"+a,e),c(b.detail[0])};d.unshift(a),j.observer.on("thread:"+a,e),b.postMessage(d)}},compile:function(a,b){var c,d=this.setup(a);for(c in a)h[c]=this.call_handler(c,d,b)},parse:function(a,b){var c,d,e,f=[];for(c in a)if(e=a[c],null!==e)if(void 0!==e){switch(e.constructor){case Date:d="new Date("+e.valueOf()+")";break;case Object:d="{"+this.parse(e).join(",")+"}";break;case Array:d="["+this.parse(e,!0).join(",")+"]";break;case String:d='"'+e.replace(/"/g,'\\"')+'"';break;case RegExp:case Function:d=e.toString(),d=d.replace(/\bself\b/g,"this."+c);break;default:d=e}b?f.push(d):f.push(c+":"+d)}else f.push(c+":undefined");else f.push(c+":null");return f},parseFunc:function(a,b){var c,d,e=b.toString();return c=e.match(/functio.+?\((.*?)\)/)[1].split(","),d=e.match(/functio.+?\{([\s\S]*)\}/i)[1].trim(),d=d.replace(/\bself\b/g,"this."+a),d=d.replace(/\brequire\b/g,"this._globals.require"),d=d.replace(/\bmodule\b/g,"this._globals.module"),d=d.replace(/\bthis.pause\b/g,"this._globals.qure.pause"),d=d.replace(/\bthis.precede\b/g,"this._globals.qure.precede"),d=d.replace(/\bthis.then\b/g,"this._globals.qure.then"),d=d.replace(/\bthis.resume\b/g,"this._globals.qure.resume"),c.push(d),Function.apply({},c)},observer:i()};d.prototype={doload:function(a){var b,c=JSON.parse(a.target.responseText),d=[],e=!0;if(this.hash){this.hash[this.key]=c;for(b in this.hash)"string"==typeof this.hash[b]&&(e=!1);e&&d.push(this.hash._single?this.hash._single:this.hash)}this.owner.queue._paused=!1,this.owner.queue.flush.apply(this.owner.queue,d)}},e.prototype={fork:function(){return new e},wait:function(a){var b=this,c=function(){setTimeout(function(){b.queue._paused=!1,b.queue.flush()},a||0)};return c._paused=!0,this.queue.push(c),this},then:function(a){var b=this,c=function(){var c=[];g._globals.res?(c.push(g._globals.res),delete g._globals.res):c=arguments,a.apply(b.queue._that,c)};return this.queue.push(c),this},require:function(a,b,c){var e=this,f=function(){var f=new d(e,a,b,c);f.send()};if("object"==typeof a){for(var g in a)this.require(a[g],a,g);return this}return b?(f._paused=!0,this.queue.push(f),this):(this.require({_single:a}),this)},declare:function(a){var b=this,c=function(){var c,d,e={};"function"==typeof a&&(a={single_anonymous_func:a});for(c in a)d=a[c],d.constructor===Function&&("Sync"===c.slice(-4)?g[c]=j.parseFunc(c,a[c]):e[c]=a[c]);j.compile(e,function(){b.precede(function(){b.pause()}),b.resume.apply(b,arguments)})};return this.queue.push(c),this},run:function(){var a=this,b=[].slice.call(arguments),c=function(){var c=h[b[0]]||g[b[0]]?b.shift():"single_anonymous_func";g[c]?(g._globals.qure=a,g._globals.res=g[c].apply(g,b)):(a.pause(),h[c].apply(h,b))};return this.queue.push(c),this},precede:function(a){return this.queue.unshift(a),this},resume:function(){return this.queue._paused=!1,this.queue.flush.apply(this.queue,arguments),this},pause:function(a){return a=a||function(){},a._paused=!0,this.queue.unshift(a),this}},a.Qure=b.exports=new e}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{});