/*
 * qure.js [v0.2.30]
 * https://github.com/hbi99/qure.js 
 * Copyright (c) 2013-2018, Hakan Bilgin <hbi@longscript.com> 
 * Licensed under the MIT License
 */
!function(window,module){"use strict";function Queue(e,s){this._methods=[],this._owner=e,this._that=s,this._paused=!1}function CORSreq(e,s,t,r){var n,u,o=new window.XMLHttpRequest,i=s.method||"GET",a=s.url;if(o.onreadystatechange=this.readystatechange,o.autoParse=this.autoParse,o.hash=t,o.key=r,o.url=a,o.owner=e,s.data&&(n=param.parse(s.data),"GET"===i&&s.data&&(a+=a.indexOf("?")===-1?"?":"&",a+=param.parse(s.data))),"withCredentials"in o&&o.open(i,a,!0),s.headers)for(u in s.headers)o.setRequestHeader(u,s.headers[u]);else o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.send(n)}function Qure(){var e={};return this.queue=new Queue(this,e),this}var isNode=!!module.id,syncFunc={_globals:{require:!!isNode&&require,module:!!isNode&&module}},workFunc={},seqFunc={};Queue.prototype={push:function(e){this._methods.push(e),this._paused||this.flush()},unshift:function(e){this._methods.unshift(e),this._paused||e._paused||this.flush()},flush:function(){var e,s=arguments;if(!this._paused)for(;this._methods.length;)if(e=this._methods.shift(),e.apply(this._that,s),e._paused){this._paused=!0;break}}};var x10={setup:function(e){var s,t,r,n=window.URL||window.webkitURL,u="var tree = {"+this.parse(e).join(",")+"};";return isNode?(r=function(s){var t=JSON.parse(s).data,r=t.shift(),n=e[r].apply(e,t);process.send(JSON.stringify([r,n]))},t=t=new window.Worker,u=u+'process.on("message", '+r.toString()+");",t.postMessage(u)):(r=function(s){var t=Array.prototype.slice.call(s.data,1),r=s.data[0],n=e[r].apply(e,t);postMessage([r,n])},s=new Blob([u+'self.addEventListener("message", '+r.toString()+", false);"],{type:"text/javascript"}),t=new window.Worker(n.createObjectURL(s))),t.onmessage=function(e){var s=Array.prototype.slice.call(e.data,1),t=e.data[0];["pause","resume","precede","fork","abort"].indexOf(t)===-1&&(t="resume"),this.qure[t].apply(this.qure,s)},t},call_handler:function(e,s,t){return function(){var r=Array.prototype.slice.call(arguments);r.unshift(e),t.pause(!0),s.qure=t,s.postMessage(r)}},compile:function(e,s){var t,r=this.setup(e);for(t in e)workFunc[t]=this.call_handler(t,r,s);workFunc._worker=r},parse:function(e,s){var t,r,n,u=[];for(t in e)if(n=e[t],null!==n)if(void 0!==n){switch(n.constructor){case Date:r="new Date("+n.valueOf()+")";break;case Object:r="{"+this.parse(n).join(",")+"}";break;case Array:r="["+this.parse(n,!0).join(",")+"]";break;case String:r='"'+n.replace(/"/g,'\\"')+'"';break;case RegExp:r=n.toString(),r='new RegExp("'+r.slice(1,r.lastIndexOf("/"))+'", "'+r.slice(r.lastIndexOf("/")+1)+'")';break;case Function:r=n.toString().replace(/^(?!var)\bself\b/g,"this."+t);break;default:r=n}s?u.push(r):u.push(t+":"+r)}else u.push(t+":undefined");else u.push(t+":null");return isNode&&(u.push("fork    : function() { process.send(JSON.stringify(['fork'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("abort   : function() { process.send(JSON.stringify(['abort'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("pause   : function() { process.send(JSON.stringify(['pause'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("resume  : function() { process.send(JSON.stringify(['resume'].concat(Array.prototype.slice.call(arguments)))); }"),u.push("precede : function() { process.send(JSON.stringify(['precede'].concat(Array.prototype.slice.call(arguments)))); }")),u},parseFunc:function(e,s){var t,r,n=s.toString();return t=n.match(/functio.+?\((.*?)\)/)[1].split(","),r=n.match(/functio.+?\{([\s\S]*)\}/i)[1].trim(),r=r.replace(/^(?!var)\bself\b/g,"this."+e),r=r.replace(/\brequire\b/g,"this._globals.require"),r=r.replace(/\bmodule\b/g,"this._globals.module"),r=r.replace(/\.fork\(/g,"._globals.qure.fork("),r=r.replace(/\.abort\(/g,"._globals.qure.abort("),r=r.replace(/\.pause\(/g,"._globals.qure.pause("),r=r.replace(/\.resume\(/g,"._globals.qure.resume("),r=r.replace(/\.precede\(/g,"._globals.qure.precede("),t.push(r),Function.apply({},t)}};CORSreq.prototype={readystatechange:function(e){var s,t,r,n=e.target,u={},o=[],i=!0;if(200===n.status&&4===n.readyState){if(t=this.autoParse(this.url,n),r={responseText:t.responseText,status:n.status},t.responseJSON&&(r.responseJSON=t.responseJSON),t.responseXML&&(r.responseXML=t.responseXML),this.hash){this.hash[this.key]=r;for(s in this.hash)200!==this.hash[s].status&&(i=!1);if(i){for(s in this.hash)u[s]=this.hash[s].responseJSON||this.hash[s].responseXML||this.hash[s].responseText;r.responseText?o.push(this.hash._single?this.hash._single.responseText:u):o.push(t)}}else o.push(r);this.owner.queue._paused=!1,this.owner.queue.flush.apply(this.owner.queue,o)}},autoParse:function(url,req){var str=req.responseText,isDeclare="?declare"===url.slice(-8),ext=url.split("."),ctype=req.headers&&req.getResponseHeader?req.getResponseHeader("Content-Type").match(/.+\/(\w+)?/)[1]:ext[ext.length-1],ret={responseText:str},type,parser;switch(ext=ext[ext.length-1],isDeclare?ext=ext.slice(0,-8):url===ext&&(ext=ctype),ext){case"css":isNode?ret=str:(ret=window.document.createElement("style"),ret.innerHTML=str);break;case"js":isNode||isDeclare?(eval("(function(window, module) {"+str+'}).bind({})(\ttypeof window !== "undefined" ? window : {},\ttypeof module !== "undefined" ? module : {});'),ret=module.exports,delete module.exports):(ret=document.createElement("script"),ret.type="text/javascript",ret.appendChild(document.createTextNode(str)));break;case"json":ret.responseJSON=JSON.parse(str);break;case"htm":case"html":type="text/html";case"xml":case"xsl":isNode?ret=str:(parser=new DOMParser,ret.responseXML=parser.parseFromString(str,type||"text/xml"))}return ret}};var param={parse:function(e){var s,t=this;if(this.serialize=[],e.constructor===Array)e.forEach(function(e,s){t.add(s,e)});else for(s in e)this.build(s,e[s]);return this.serialize.join("&")},add:function(e,s){s=s.constructor===Function?s():null===s?"":s,this.serialize.push(encodeURIComponent(e)+"="+encodeURIComponent(s))},build:function(e,s){var t,r=this;if(s.constructor===Array)s.forEach(function(s,t){r.build(e+"["+("object"==typeof s&&null!==s?t:"")+"]",s)});else if("object"==typeof s)for(t in s)this.build(e+"["+t+"]",s[t]);else this.add(e,s)}};Qure.prototype={fork:function(){return new Qure},wait:function(e){var s=this,t=function(){setTimeout(function(){s.queue._paused=!1,s.queue.flush()},e||0)};return t._paused=!0,this.queue.push(t),this},then:function(e){var s=this,t=function(){var t=[];syncFunc._globals.res?(t.push(syncFunc._globals.res),delete syncFunc._globals.res):t=arguments,syncFunc._globals.res=e.apply(s.queue._that,t),!s.queue._methods.length&&workFunc._worker&&workFunc._worker.process&&workFunc._worker.process.kill()};return this.queue.push(t),this},xhr:function(e){var s=this,t=function(){new CORSreq(s,e)};return t._paused=!0,this.queue.push(t),this},load:function(e,s,t){var r,n=this,u=function(){new CORSreq(n,e,s,t)};if(!s&&"object"==typeof e){for(r in e)this.load({url:e[r]},e,r);return this}return s?(u._paused=!0,this.queue.push(u),this):this.load({_single:e})},declare:function(e){var s=this,t=function(){var t,r,n={},u=e.workers;for(t in e)r=e[t],r.constructor===Function?u?n[t]=e[t]:syncFunc[t]=x10.parseFunc(t,e[t]):syncFunc[t]=n[t]=e[t];x10.compile(n,s)};if(this._record=e,"string"==typeof e){var r=function(r){s.precede(function(){e+="?declare",s.fork().load(e).then(function(r){e=r,t(r),s.resume()})})};r._paused=!0,this.precede(r)}else this.queue.push(t);return this},run:function(){var e=this,s=Array.prototype.slice.call(arguments),t=function(){var t=s.shift(),r=syncFunc._globals.res;if(r&&(r.constructor!==Array&&(r=[r]),s=s.concat(r)),syncFunc[t])syncFunc._globals.qure=e,syncFunc._globals.res=syncFunc[t].apply(syncFunc,s);else if(seqFunc[t]){var n=seqFunc[t],u=n.queue._methods.slice(0);n.resume(s),n.queue._methods=u}else e.pause(!0),workFunc[t].apply(workFunc,s)};return"function"==typeof s[0]?this.then.apply(e,s):(this.queue.push(t),this)},precede:function(e){return this.queue._methods.length&&this.queue._methods[0]._paused?this.queue._methods.splice(1,0,e):this.queue.unshift(e),this},resume:function(){var e=Array.prototype.slice.call(arguments),s=this.queue._methods[0];return this.queue._paused=!1,s&&s._paused&&"function () {}"===s.toString()&&this.queue._methods.shift(),this.queue.flush.apply(this.queue,e),this},pause:function(e){var s=function(){};return s._paused=!0,e?this.queue.unshift(s):this.queue.push(s),this},sequence:function(e,s){var t=this.fork(),r=function(e){s.apply(t.fork(),e)};return t.queue._methods=[r],seqFunc[e]=t,this},abort:function(e){var s=this,t=function(){s.pause(!0),"function"==typeof e&&e.apply(s.queue._that,[]),s.queue.flush(),s.queue._methods=[]};return this.queue.push(t),this}},isNode&&(window.Worker=require("./../src/worker"),window.XMLHttpRequest=require("./../src/xhr")),window.Qure=module.exports=new Qure}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{});